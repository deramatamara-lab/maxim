#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run type check
echo "ğŸ“ Type checking..."
pnpm run lint:types || {
  echo "âŒ Type check failed. Fix TypeScript errors before committing."
  exit 1
}

# Run linter
echo "ğŸ”§ Linting..."
pnpm run lint --max-warnings 0 || {
  echo "âŒ Lint failed. Fix linting errors before committing."
  exit 1
}

# Check for console statements
echo "ğŸš« Checking for console statements..."
if git diff --cached --name-only | grep -E '\.(ts|tsx)$' | xargs grep -l "console\.\(log\|debug\|info\)" 2>/dev/null; then
  echo "âŒ Found console.log/debug/info statements in staged files."
  echo "   Use structured logger (import { log } from '@/utils/logger') instead."
  exit 1
fi

# Check for secrets
echo "ğŸ” Checking for secrets..."
if git diff --cached | grep -E "sk_live_|pk_live_|api_key.*=.*['\"][a-zA-Z0-9]{20,}"; then
  echo "âŒ Found potential secrets in staged changes."
  echo "   Never commit API keys or secrets."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
